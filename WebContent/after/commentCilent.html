<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<script>
			window.onload = function() {
				loadCommentList();
			}
	
			function loadCommentList() {	
				new ajax.xhr.Request("commentlist.jsp", "", loadCommentResult, 'GET');	
			}
	
			function loadCommentResult(req) {	
				if (req.readyState == 4) {
					if (req.status == 200) {
						var xmlDoc = req.responseXML;
						var code = xmlDoc.getElementsByTagName('code').item(0).firstChild.nodeValue;
						if (code == 'success') {
							var commentList = eval( "(" +xmlDoc.getElementsByTagName('data').item(0)
									.firstChild.nodeValue +")" );
	
							var listDiv = document.getElementById('commentList');
							for (var i = 0 ; i < commentList.length ; i++) {
							var commentDiv = makeCommentView(commentList[i]);
							listDiv.appendChild(commentDiv);
							}
						} else if (code == 'error') {
							var message = xmlDoc.getElementsByTagName('message')
								.item(0).firstChild.nodeValue;
							alert("에러 발생:"+message);
						}	
				   } else {	
						alert("댓글 목록 로딩 실패:"+req.status);
						}
					}
				}
			function makeCommentView(comment) {
				var commentDiv = document.createElement('div');
				commentDiv.setAttribute('am_num', 'c'+comment.am_num);
				var html = '<strong>'+comment.m_id+'</strong><br/>'+
				comment.content.replace(/\n/g, '\n<br/>')+'<br/>'+
				'<input type="button" value="수정" '+
				'onclick="viewUpdateForm('+comment.am_num+')"/>'+
				'<input type="button" value="삭제" '+
				'onclick="confirmDeletion('+comment.am_num+')"/>' ;
				commentDiv.innerHTML = html;
				commentDiv.comment = comment;
				commentDiv.className = "comment";
				return commentDiv;
			}
		</script>
	</head>
	<body>
	
	</body>
</html>